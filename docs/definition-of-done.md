# Definition of Done (DoD) - process-network-monitor

## 1. この文書の目的

この文書は「どこまで実装したら、いったんプロダクトを完了とみなすか」を定義する。
Issueが増え続けても、リリース判断をぶらさないための基準として使う。

---

## 2. 開発経緯（要約）

### 初期フェーズ（基本機能の成立）
- #1 基本的な通信取得とグラフ表示（完了）
- #3 単位の自動調整機能（完了）
- #6 No traffic detected 表示位置修正（完了）
- #7 通信量が0になりやすい計測ロジック改善 + 再現モード（完了）

### 信頼性・保守性フェーズ（2026-02-27）
- #10 エラーハンドリング強化（完了、PR #16 マージ済み）
- #11 スキャナ参照寿命短縮・メモリ傾向改善（完了、PR #17 マージ済み）
- #12 初期待機の固定2秒を廃止し準備完了シグナルで開始（完了、PR #21 マージ済み）
- Reliability & Maintainability マイルストーンを設定

### 現在の未完了課題
- #13 グローバル状態を削減しテスト容易性を改善（OPEN）
- #14 計測タイミングを単調増加クロックへ統一し精度向上（対応済み、クローズ待ち）
- #15 printベース出力をloggingへ移行（OPEN）

---

## 3. 現在地（2026-03-01時点）

- 高優先（priority:high）は #10, #11 を解消済み
- v1.0 Mustのうち #12 は解消済み（PR #21 マージ）
- 実行上の致命リスクは低減済み
- ただし、設計整理・運用ログは改善余地あり（#13, #15）

結論：
「壊れにくくなり、v1.0 Mustは実装完了（#14クローズ待ち）段階。」

---

## 4. v1.0 の対象範囲（今回の“終わり”）

v1.0では、以下を**必須（Must）**とする。

前提（計測対象の定義）:
- v1.0 の計測対象は「プロセスI/O差分（`read_bytes + write_bytes`）」とする
- 厳密なプロセス別ネットワーク送受信量の取得は v2.0 の対象とする

1. 測定と出力の成立
- デフォルト実行で計測完了し、`network_traffic.png` を保存できる
- `FORCE_NO_TRAFFIC=1` 実行でも異常終了しない

2. 信頼性
- 想定外エラー時にハングせず終了する
- バックグラウンドスレッド停止の後始末が保証される

3. 直近の中優先課題のうち、v1.0品質に直結する項目
- #14 単調増加クロック化（`time.perf_counter()` ベース）

4. ドキュメント
- READMEに実行方法、再現モード、メモリ確認手順がある
- 本DoD文書が最新状態になっている

---

## 5. v1.0 Definition of Done（完了判定）

以下を満たしたら v1.0 完了と判定する。

### A. 実装
- [x] #12 がクローズされている
- [x] #14 がクローズされている（実装完了ベース）
- [x] #10, #11 の回帰が発生していない（v1.0最小回帰確認範囲）

### B. 動作確認（最小セット）
- [x] `python3 monitor_network.py` が成功終了（exit code 0）
- [x] `FORCE_NO_TRAFFIC=1 python3 monitor_network.py` が成功終了（exit code 0）
- [x] 連続5回実行で極端なメモリ増加が再現しない（peak_rss_kb: 77824〜78208）

### C. 開発プロセス
- [x] すべてPR経由で main に反映（PR #21, #22）
- [x] 各Issueに「対応内容」「確認結果」がコメントで残っている（Issue #19にEvidence記録）

### D. リリース判断
- [x] Must課題が0件（#12, #14 CLOSED）
- [x] 未対応課題は v1.1 バックログへ移管済み（#13, #15を明示）

---

## 6. v1.1 へ回す項目（現時点案）

- #13 グローバル状態のさらなる整理（テスト容易性の改善）
- #15 logging移行（運用性向上）

理由：
v1.0の必須品質に対しては優先度が一段下がるため。

---

## 6.5 v2.0 検討テーマ（方向性）

- メトリクスの中心を「I/O差分」から「プロセス別ネットワーク送受信量」へ拡張する
- 収集方式のOS依存性・権限制約・フォールバック戦略を明文化する
- v1.0のI/Oベース計測は互換モードとして維持するかを判断する

---

## 7. 追加Issue候補（必要なら作成）

DoD運用を安定化するため、次のIssue追加を推奨。

1. [Process] v1.0 リリースチェックリストを作成
- 目的: DoDのA〜Dを1つの追跡Issueで見える化する

2. [Docs] Definition of Done の運用ルールをREADMEにリンク
- 目的: 新規参加者が完了基準を迷わないようにする

3. [Test] 最小回帰チェックの自動化（通常実行/再現モード）
- 目的: #10/#11 の品質を継続的に守る

---

## 8. 運用ルール（短縮版）

- 新しいIssueは Must / Should / Could のいずれかに分類する
- v1.0では Must のみを完了対象とする
- Mustが0になった時点で「v1.0 完了」を宣言する
- その後の改善は v1.1 として別管理する
